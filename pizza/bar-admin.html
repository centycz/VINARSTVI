<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bar Admin - Spr√°va Menu</title>
<link rel="stylesheet" href="theme.css">
<style>
/* === √öPRAVA BAREV NA THEME (funkƒçnost zachov√°na) === */

body{
  background:var(--bg-gradient);
  font-family:var(--font-stack);
  color:var(--c-text);
  margin:0;
  padding:26px 20px 40px;
}
.container{
  max-width:1400px;
  margin:0 auto 40px;
  background:linear-gradient(150deg,#1c2735,#223246 55%,#273a53);
  border:1px solid var(--c-border);
  border-radius:30px;
  padding:30px 32px 40px;
  box-shadow:var(--shadow);
  position:relative;
  overflow:hidden;
}
.container:before{
  content:"";
  position:absolute;
  inset:0;
  background:
    radial-gradient(at 11% 15%,rgba(99,102,241,.18),transparent 60%),
    radial-gradient(at 88% 82%,rgba(236,72,153,.14),transparent 65%);
  pointer-events:none;
}
.card{
  background:linear-gradient(160deg,#233247,#1d2938);
  border:1px solid var(--c-border);
  border-radius:24px;
  padding:24px 26px 28px;
  margin-bottom:28px;
  position:relative;
  overflow:hidden;
  box-shadow:var(--shadow-sm);
}
.card:before{
  content:"";
  position:absolute;
  inset:0;
  background:radial-gradient(at 88% 18%,rgba(99,102,241,.25),transparent 70%);
  opacity:.55;
  pointer-events:none;
}
.card h1,.card h2{
  margin:0 0 18px;
  font-weight:600;
  letter-spacing:.6px;
  background:var(--gradient-accent);
  -webkit-background-clip:text;
  color:transparent;
}
.nav-links{
  display:flex;
  justify-content:center;
  gap:10px;
  flex-wrap:wrap;
  margin:0 0 8px;
  padding:0;
}
.nav-links a{
  padding:9px 18px 10px;
  background:var(--glass);
  border:1px solid var(--c-border);
  color:var(--c-text-soft);
  text-decoration:none;
  border-radius:26px;
  font-weight:600;
  font-size:.68rem;
  letter-spacing:.55px;
  backdrop-filter:blur(6px);
  transition:var(--trans);
}
.nav-links a:hover{
  background:var(--glass-strong);
  color:var(--c-text);
  border-color:var(--c-accent);
  transform:translateY(-2px);
}
.form-group label{
  font-size:.6rem;
  font-weight:600;
  letter-spacing:.6px;
  color:var(--c-text-dim);
  text-transform:uppercase;
  margin-bottom:6px;
  display:block;
}
.form-group small{font-size:.55rem;color:var(--c-text-dim);}
.form-row{display:flex;gap:20px;flex-wrap:wrap;margin:0 0 6px;}
.form-row .form-group{flex:1;min-width:200px;}
input[type=text],input[type=number],textarea,select{
  background:#162230;
  border:1px solid var(--c-border);
  color:var(--c-text);
  padding:10px 12px;
  border-radius:12px;
  font-size:.7rem;
  font-weight:500;
  letter-spacing:.3px;
  outline:none;
  transition:var(--trans);
}
input:focus,textarea:focus,select:focus{
  border-color:var(--c-accent);
  box-shadow:var(--focus-ring);
}
textarea{min-height:90px;resize:vertical;}
.btn{
  --btn-bg:var(--glass);
  --btn-color:var(--c-text-soft);
  --btn-border:var(--c-border);
  background:var(--btn-bg);
  color:var(--btn-color);
  border:1px solid var(--btn-border);
  padding:10px 18px;
  border-radius:14px;
  font-size:.65rem;
  font-weight:600;
  letter-spacing:.55px;
  cursor:pointer;
  display:inline-flex;
  align-items:center;
  gap:.5rem;
  transition:var(--trans);
}
.btn:hover{background:var(--glass-strong);color:var(--c-text);border-color:var(--c-accent);}
.btn-success{background:var(--gradient-success);border:none;color:#fff;box-shadow:0 8px 22px -10px rgba(16,185,129,.45);}
.btn-success:hover{filter:brightness(1.08);}
.btn-warning{background:var(--gradient-warning);border:none;color:#2e1600;}
.btn-warning:hover{filter:brightness(1.05);}
.btn-danger{background:var(--gradient-danger);border:none;color:#fff;}
.btn-danger:hover{filter:brightness(1.05);}
.alert{
  padding:14px 16px;
  border-radius:16px;
  font-size:.62rem;
  font-weight:600;
  letter-spacing:.5px;
  margin:0 0 18px;
  display:flex;
  justify-content:center;
}
.alert-success{background:#134e4a;border:1px solid #0d8f7e;color:#d1fae5;}
.alert-error{background:#601d1d;border:1px solid #dc2626;color:#fecaca;}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:16px;
  font-size:.63rem;
}
th,td{
  padding:10px 12px;
  border-bottom:1px solid var(--c-border-soft);
  text-align:left;
  vertical-align:top;
}
th{
  background:#1b2a3a;
  font-weight:600;
  color:var(--c-text-dim);
  letter-spacing:.55px;
  position:sticky;
  top:0;
  z-index:1;
  font-size:.6rem;
}
tbody tr:hover td{background:#152131;}
code.code-field{
  background:#223248;
  border:1px solid var(--c-border);
  padding:3px 6px 4px;
  border-radius:8px;
  font-size:.55rem;
  font-family:var(--font-mono);
  color:var(--c-text-soft);
}
.status-active{color:var(--c-success);font-weight:700;}
.status-inactive{color:var(--c-danger-alt);font-weight:700;}
.loading{font-style:italic;color:var(--c-text-dim);font-size:.6rem;padding:30px 0;text-align:center;}
/* Modal */
.modal{
  position:fixed;
  inset:0;
  background:rgba(10,16,25,.65);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1400;
  padding:34px 20px;
}
.modal-content{
  background:linear-gradient(155deg,#1f2f44,#25364b);
  border:1px solid var(--c-border);
  border-radius:28px;
  width:100%;
  max-width:640px;
  padding:28px 30px 34px;
  position:relative;
  box-shadow:var(--shadow-lg),0 0 0 1px rgba(255,255,255,.05);
  color:var(--c-text-soft);
  font-size:.7rem;
  line-height:1.35;
  max-height:90vh;
  overflow:auto;
}
.close{
  position:absolute;
  top:10px;
  right:14px;
  font-size:1.2rem;
  cursor:pointer;
  background:var(--gradient-danger);
  width:34px;
  height:34px;
  border-radius:12px;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
  font-weight:700;
  box-shadow:0 6px 16px -6px rgba(0,0,0,.55);
}
.close:hover{filter:brightness(1.07);}
.cost-info{
  background:#162230;
  border:1px solid var(--c-border);
  color:var(--c-text-soft);
  border-radius:14px;
  padding:10px 14px;
  font-size:.6rem;
  line-height:1.4;
  margin-top:6px;
}
.margin-good{color:var(--c-success);font-weight:700;}
.margin-warning{color:var(--c-warning);font-weight:700;}
.margin-danger{color:var(--c-danger-alt);font-weight:700;}
@media (max-width:760px){
  .form-row{flex-direction:column;gap:14px;}
  .modal-content{padding:26px 24px 32px;}
  .nav-links a{font-size:.6rem;padding:7px 14px 8px;}
}
</style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Bar Admin - Spr√°va Menu</h1>
      <div class="nav-links">
        <a href="index.html">Dom≈Ø</a>
        <a href="admin.html">Pizza Admin</a>
        <a href="data.html">Statistiky</a>
      </div>
    </div>

    <div id="alerts"></div>

    <div class="card">
      <h2>P≈ôidat Nov√Ω N√°poj</h2>
      <form id="addDrinkForm">
        <div class="form-row">
          <div class="form-group">
            <label>Kategorie n√°poje</label>
            <select name="category" required>
              <option value="">Vyberte kategorii</option>
              <optgroup label="N√°poje">
                <option value="kava">K√°va</option>
                <option value="pivo">Pivo</option>
                <option value="vino">V√≠no</option>
                <option value="nealko">Nealko</option>
                <option value="spritz">Spritz</option>
                <option value="negroni">Negroni</option>
                <option value="koktejl">Koktejl</option>
                <option value="digestiv">Digestiv</option>
              </optgroup>
            </select>
          </div>
          <div class="form-group">
            <label>Typ n√°poje (kl√≠ƒç)</label>
            <input type="text" name="type" placeholder="nap≈ô. limonada" required>
            <small>jedineƒçn√Ω kl√≠ƒç (mal√° p√≠smena / ƒç√≠sla)</small>
          </div>
          <div class="form-group">
            <label>N√°zev n√°poje</label>
            <input type="text" name="name" placeholder="nap≈ô. Limon√°da" required>
          </div>
        </div>
        <div class="form-group">
          <label>Popis</label>
          <textarea name="description" placeholder="Popis n√°poje a ingredienc√≠"></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>üí∞ Prodejn√≠ cena (Kƒç)</label>
            <input type="number" name="price" placeholder="35" required step="0.01" min="0" oninput="calculateMargin()">
          </div>
            <div class="form-group">
            <label>ü•§ N√°kladov√° cena (Kƒç)</label>
            <input type="number" name="cost_price" placeholder="12" step="0.01" min="0" oninput="calculateMargin()">
            <small>cena surovin</small>
          </div>
          <div class="form-group">
            <label>Stav</label>
            <select name="is_active">
              <option value="1">Aktivn√≠</option>
              <option value="0">Neaktivn√≠</option>
            </select>
          </div>
        </div>
        <div class="cost-info" id="marginCalculator" style="display:none;">
          <strong>üíπ Food Cost Anal√Ωza:</strong><br>
          <span id="marginInfo">Vypl≈àte prodejn√≠ a n√°kladovou cenu</span>
        </div>
        <button type="submit" class="btn btn-success" style="margin-top:14px;">P≈ôidat N√°poj</button>
      </form>
    </div>

    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px;">
        <h2 style="margin:0;">Seznam N√°poj≈Ø</h2>
        <button onclick="loadDrinks()" class="btn">Obnovit seznam</button>
      </div>
      <div id="drinkList" class="loading">Naƒç√≠t√°m...</div>
    </div>
  </div>

  <!-- Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2 style="margin:0 0 18px;background:var(--gradient-accent);-webkit-background-clip:text;color:transparent;">Upravit N√°poj</h2>
      <form id="editDrinkForm">
        <input type="hidden" name="editType" id="editType">
        <div class="form-row">
          <div class="form-group">
            <label>Kategorie n√°poje</label>
            <select name="category" id="editCategory" required>
              <option value="">Vyberte kategorii</option>
              <optgroup label="N√°poje">
                <option value="kava">K√°va</option>
                <option value="pivo">Pivo</option>
                <option value="vino">V√≠no</option>
                <option value="nealko">Nealko</option>
                <option value="spritz">Spritz</option>
                <option value="negroni">Negroni</option>
                <option value="koktejl">Koktejl</option>
                <option value="digestiv">Digestiv</option>
              </optgroup>
            </select>
          </div>
          <div class="form-group">
            <label>Typ n√°poje (kl√≠ƒç)</label>
            <input type="text" name="type" id="editTypeField" readonly class="code-field">
            <small>nelze mƒõnit</small>
          </div>
          <div class="form-group">
            <label>N√°zev n√°poje</label>
            <input type="text" name="name" id="editName" required>
          </div>
        </div>
        <div class="form-group">
          <label>Popis</label>
          <textarea name="description" id="editDescription" placeholder="Popis n√°poje a ingredienc√≠"></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>üí∞ Prodejn√≠ cena (Kƒç)</label>
            <input type="number" name="price" id="editPrice" required step="0.01" min="0" oninput="calculateEditMargin()">
          </div>
          <div class="form-group">
            <label>ü•§ N√°kladov√° cena (Kƒç)</label>
            <input type="number" name="cost_price" id="editCostPrice" step="0.01" min="0" oninput="calculateEditMargin()">
          </div>
          <div class="form-group">
            <label>Stav</label>
            <select name="is_active" id="editActive">
              <option value="1">Aktivn√≠</option>
              <option value="0">Neaktivn√≠</option>
            </select>
          </div>
        </div>
        <div class="cost-info" id="editMarginCalculator" style="display:none;">
          <strong>üíπ Food Cost Anal√Ωza:</strong><br>
          <span id="editMarginInfo">Vypl≈àte prodejn√≠ a n√°kladovou cenu</span>
        </div>
        <div style="margin-top:20px;display:flex;gap:12px;flex-wrap:wrap;">
          <button type="submit" class="btn btn-success">Ulo≈æit zmƒõny</button>
          <button type="button" class="btn outline" onclick="closeEditModal()">Zru≈°it</button>
        </div>
      </form>
    </div>
  </div>

<script>
/* ======= p≈Øvodn√≠ JS K√ìD ‚Äì NEUPRAVEN ======= */
const API_BASE = 'api/restaurant-api.php';
let drinks = [];

/* food cost kalkulace */
function calculateMargin() {
  const price = parseFloat(document.querySelector('input[name="price"]').value) || 0;
  const costPrice = parseFloat(document.querySelector('input[name="cost_price"]').value) || 0;
  const calculator = document.getElementById('marginCalculator');
  const info = document.getElementById('marginInfo');
  if (price > 0 && costPrice >= 0) {
    calculator.style.display = 'block';
    const margin = price - costPrice;
    const marginPercent = price > 0 ? ((margin / price) * 100) : 0;
    const foodCostPercent = price > 0 ? ((costPrice / price) * 100) : 0;
    let marginClass = 'margin-good';
    let status = '‚úÖ V√Ωborn√° mar≈æe';
    if (foodCostPercent > 30) { marginClass = 'margin-danger'; status = '‚ùå Vysok√Ω food cost'; }
    else if (foodCostPercent > 20) { marginClass = 'margin-warning'; status = '‚ö†Ô∏è St≈ôedn√≠ food cost'; }
    info.innerHTML = `
      <span class="${marginClass}">${status}</span><br>
      Mar≈æe: <strong>${margin.toFixed(2)} Kƒç</strong> (${marginPercent.toFixed(1)}%)<br>
      Food cost: <strong>${foodCostPercent.toFixed(1)}%</strong>
    `;
  } else {
    calculator.style.display = 'none';
  }
}
function calculateEditMargin() {
  const price = parseFloat(document.getElementById('editPrice').value) || 0;
  const costPrice = parseFloat(document.getElementById('editCostPrice').value) || 0;
  const calculator = document.getElementById('editMarginCalculator');
  const info = document.getElementById('editMarginInfo');
  if (price > 0 && costPrice >= 0) {
    calculator.style.display = 'block';
    const margin = price - costPrice;
    const marginPercent = price > 0 ? ((margin / price) * 100) : 0;
    const foodCostPercent = price > 0 ? ((costPrice / price) * 100) : 0;
    let marginClass = 'margin-good';
    let status = '‚úÖ V√Ωborn√° mar≈æe';
    if (foodCostPercent > 30) { marginClass = 'margin-danger'; status = '‚ùå Vysok√Ω food cost'; }
    else if (foodCostPercent > 20) { marginClass = 'margin-warning'; status = '‚ö†Ô∏è St≈ôedn√≠ food cost'; }
    info.innerHTML = `
      <span class="${marginClass}">${status}</span><br>
      Mar≈æe: <strong>${margin.toFixed(2)} Kƒç</strong> (${marginPercent.toFixed(1)}%)<br>
      Food cost: <strong>${foodCostPercent.toFixed(1)}%</strong>
    `;
  } else {
    calculator.style.display = 'none';
  }
}
function showAlert(message, type) {
  const alertsContainer = document.getElementById('alerts');
  const alert = document.createElement('div');
  alert.className = `alert alert-${type}`;
  alert.textContent = message;
  alertsContainer.appendChild(alert);
  setTimeout(() => { if (alert.parentNode) alert.remove(); }, 5000);
}
async function loadDrinks() {
  try {
    const response = await fetch(`${API_BASE}?action=drink-menu-admin`);
    const data = await response.json();
    if (data.success) {
      drinks = data.data.drinks || [];
      renderDrinkList();
    } else {
      showAlert(data.error || 'Chyba p≈ôi naƒç√≠t√°n√≠', 'error');
    }
  } catch (e) {
    showAlert('Chyba p≈ôi naƒç√≠t√°n√≠: ' + e.message, 'error');
    document.getElementById('drinkList').innerHTML = '<p style="color: var(--c-danger-alt);">Chyba p≈ôi naƒç√≠t√°n√≠ dat</p>';
  }
}
function renderDrinkList() {
  const container = document.getElementById('drinkList');
  if (drinks.length === 0) { container.innerHTML = '<p>≈Ω√°dn√© n√°poje v nab√≠dce</p>'; return; }
  let html = `
    <table>
      <thead>
        <tr>
          <th>Kategorie</th><th>Typ</th><th>N√°zev</th><th>Popis</th>
          <th>üí∞ Cena</th><th>ü•§ N√°klady</th><th>üíπ Mar≈æe</th><th>üìä Food Cost</th>
          <th>Stav</th><th>Akce</th>
        </tr>
      </thead><tbody>
  `;
  drinks.forEach(drink=>{
    const isActive = drink.is_active == 1;
    const statusClass = isActive ? 'status-active' : 'status-inactive';
    const statusText = isActive ? 'AKTIVN√ç' : 'NEAKTIVN√ç';
    const description = drink.description ? drink.description.substring(0, 50) + (drink.description.length > 50 ? '...' : '') : '-';
    const price = parseFloat(drink.price) || 0;
    const costPrice = parseFloat(drink.cost_price) || 0;
    const margin = price - costPrice;
    const marginPercent = price > 0 ? ((margin / price) * 100) : 0;
    const foodCostPercent = price > 0 ? ((costPrice / price) * 100) : 0;
    let foodCostClass = 'margin-good';
    if (foodCostPercent > 30) foodCostClass = 'margin-danger';
    else if (foodCostPercent > 20) foodCostClass = 'margin-warning';
    html += `
      <tr>
        <td><strong>${drink.category || '-'}</strong></td>
        <td><code class="code-field">${drink.type}</code></td>
        <td><strong>${drink.name}</strong></td>
        <td title="${drink.description || ''}">${description}</td>
        <td><strong>${price.toFixed(2)} Kƒç</strong></td>
        <td><strong>${costPrice.toFixed(2)} Kƒç</strong></td>
        <td><strong class="${foodCostClass}">${margin.toFixed(2)} Kƒç</strong><br><small>(${marginPercent.toFixed(1)}%)</small></td>
        <td><strong class="${foodCostClass}">${foodCostPercent.toFixed(1)}%</strong></td>
        <td class="${statusClass}">${statusText}</td>
        <td style="display:flex;flex-direction:column;gap:6px;">
          <button class="btn" onclick="editDrink('${drink.type}')">Upravit</button>
          <button class="btn btn-warning" onclick="toggleStatus('${drink.type}')">${isActive?'Deaktivovat':'Aktivovat'}</button>
          <button class="btn btn-danger" onclick="deleteDrink('${drink.type}')">Smazat</button>
        </td>
      </tr>`;
  });
  html+='</tbody></table>';
  container.innerHTML=html;
}
document.getElementById('addDrinkForm').addEventListener('submit',async function(e){
  e.preventDefault();
  const fd=new FormData(e.target);
  const data={
    type: fd.get('type').trim().toLowerCase(),
    name: fd.get('name').trim(),
    description: fd.get('description').trim(),
    price: parseFloat(fd.get('price')),
    cost_price: parseFloat(fd.get('cost_price')) || 0,
    is_active: parseInt(fd.get('is_active')),
    category: fd.get('category')
  };
  if(!data.type.match(/^[a-z0-9_-]+$/)){
    showAlert('Typ n√°poje: pouze mal√° p√≠smena/ƒç√≠sla/-/_','error');return;
  }
  try{
    const resp=await fetch(`${API_BASE}?action=add-drink`,{
      method:'POST',headers:{'Content-Type':'application/json'},
      body:JSON.stringify(data)
    });
    const rj=await resp.json();
    if(rj.success){
      showAlert('N√°poj p≈ôid√°n','success');
      e.target.reset();
      document.getElementById('marginCalculator').style.display='none';
      loadDrinks();
    }else showAlert('Chyba: '+(rj.error||'Nezn√°m√°'), 'error');
  }catch(err){
    showAlert('Chyba: '+err.message,'error');
  }
});
function editDrink(type){
  const drink=drinks.find(d=>d.type===type);
  if(!drink){showAlert('N√°poj nenalezen','error');return;}
  editType.value=drink.type;
  editTypeField.value=drink.type;
  editName.value=drink.name;
  editDescription.value=drink.description||'';
  editPrice.value=drink.price;
  editCostPrice.value=drink.cost_price||0;
  editActive.value=drink.is_active;
  editCategory.value=drink.category;
  calculateEditMargin();
  editModal.style.display='flex';
}
function closeEditModal(){
  editModal.style.display='none';
  editMarginCalculator.style.display='none';
}
document.getElementById('editDrinkForm').addEventListener('submit',async function(e){
  e.preventDefault();
  const fd=new FormData(e.target);
  const type=fd.get('editType');
  const data={
    name:fd.get('name').trim(),
    description:fd.get('description').trim(),
    price:parseFloat(fd.get('price')),
    cost_price:parseFloat(fd.get('cost_price'))||0,
    is_active:parseInt(fd.get('is_active')),
    category:fd.get('category')
  };
  try{
    const resp=await fetch(`${API_BASE}?action=edit-drink&type=${encodeURIComponent(type)}`,{
      method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)
    });
    const rj=await resp.json();
    if(rj.success){showAlert('N√°poj upraven','success');closeEditModal();loadDrinks();}
    else showAlert('Chyba: '+(rj.error||'Nezn√°m√°'),'error');
  }catch(err){showAlert('Chyba: '+err.message,'error');}
});
async function toggleStatus(type){
  try{
    const resp=await fetch(`${API_BASE}?action=toggle-drink&type=${encodeURIComponent(type)}`,{
      method:'POST',headers:{'Content-Type':'application/json'}
    });
    const rj=await resp.json();
    if(!rj.success) showAlert('Chyba zmƒõny stavu: '+(rj.error||'Nezn√°m√°'),'error');
    loadDrinks();
  }catch(err){
    showAlert('Chyba zmƒõny stavu: '+err.message,'error');
    loadDrinks();
  }
}
async function deleteDrink(type){
  const d=drinks.find(p=>p.type===type);
  const dn=d?d.name:type;
  if(!confirm(`Opravdu smazat n√°poj "${dn}"?`)) return;
  try{
    const resp=await fetch(`${API_BASE}?action=delete-drink&type=${encodeURIComponent(type)}`,{method:'DELETE'});
    const rj=await resp.json().catch(()=>({success:false}));
    if(rj.success) showAlert('N√°poj smaz√°n','success'); else showAlert('Chyba maz√°n√≠','error');
    loadDrinks();
  }catch(err){
    showAlert('Chyba maz√°n√≠: '+err.message,'error');
    loadDrinks();
  }
}
document.querySelector('.close').addEventListener('click',closeEditModal);
window.addEventListener('click',e=>{if(e.target===editModal) closeEditModal();});
document.addEventListener('DOMContentLoaded',()=>loadDrinks());
document.addEventListener('keydown',e=>{
  if(e.key==='Escape') closeEditModal();
  if(e.key==='F5'){e.preventDefault();loadDrinks();}
});
</script>
</body>
</html>